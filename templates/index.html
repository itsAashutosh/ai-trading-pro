<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Trading Pro - Live Watchlist Dashboard</title>
    
    <!-- Using Tailwind CSS for a professional, responsive design -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- ADDED: Chart.js and Three.js libraries as requested -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <style>
        /* Custom Styles for Dark Theme */
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #e5e7eb; /* Light gray text */
            min-height: 100vh;
            padding-top: 5rem; /* Crucial padding to stop content from being hidden by the fixed navbar */
        }

        .card {
            background: rgba(30, 41, 59, 0.7); /* Slate-800 with transparency */
            backdrop-filter: blur(10px);
            border: 1px solid rgba(71, 85, 105, 0.5); /* Slate-700 border */
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.5);
        }

        /* --- New Navbar Styles --- */
        .navbar {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(71, 85, 105, 0.5); /* Slate-700 border */
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 2rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 800;
            color: #00f5ff; /* Cyan/Aqua color for logo */
            letter-spacing: 1px;
            margin-right: 1.5rem;
        }

        .nav-links {
            list-style: none;
            display: flex;
            margin: 0;
            padding: 0;
            flex-grow: 1; 
        }

        .nav-links li a {
            color: #94a3b8; /* Slate-400 */
            text-decoration: none;
            padding: 0.5rem 1rem;
            margin: 0 0.25rem;
            border-radius: 0.375rem; 
            transition: background-color 0.2s, color 0.2s;
            font-weight: 500;
        }

        .nav-links li a:hover, .nav-links li a.active {
            color: #ffffff;
            background-color: rgba(71, 85, 105, 0.3); /* Hover background (Slate-700 with transparency) */
        }
        
        .nav-links li a.active {
            border-bottom: 2px solid #00f5ff; /* Highlight active page */
            color: #00f5ff;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            font-size: 0.9rem;
            color: #cbd5e1; /* Slate-300 */
            white-space: nowrap;
        }

        .market-status {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px; /* rounded-full */
            font-weight: 600;
            font-size: 0.8rem;
        }

        .market-closed {
            background-color: #ef4444; /* Red-500 */
            color: #fff;
        }

        .market-open {
            background-color: #10b981; /* Emerald-500 */
            color: #fff;
        }
        
        .btn {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            border: none;
        }

        .btn-primary {
            background-color: #00f5ff; /* Cyan/Aqua */
            color: #1f2937; /* Dark text */
        }

        .btn-primary:hover {
            background-color: #00c7e6;
            transform: scale(1.05);
        }
        /* --- End New Navbar Styles --- */

        /* Stock Table Specific Styles (retained) */
        .stock-table th {
            padding: 1rem 1.5rem;
            text-align: left;
            font-weight: 600;
            color: #94a3b8; /* Slate-400 */
            border-bottom: 1px solid #334155;
            text-transform: uppercase;
            font-size: 0.875rem;
        }

        .stock-table td {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #1e293b; /* Darker border */
            font-size: 1rem;
        }

        /* Color classes for Price Change */
        .positive {
            color: #10b981; /* Emerald-500 (Green) */
        }

        .negative {
            color: #ef4444; /* Red-500 (Red) */
        }

        .loader {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid #00f5ff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="selection:bg-cyan-500 selection:text-black">
    <!-- NEW NAVIGATION BAR - Replaces previous navbar div -->
    <nav class="navbar">
        <div class="logo">AI TRADING PRO</div>
        <ul class="nav-links">
            <li><a href="index.html" class="active">Dashboard</a></li>
            <li><a href="portfolio.html">Portfolio</a></li>
            <li><a href="trading.html">Trading</a></li>
            <li><a href="analytics.html">Analytics</a></li>
            <li><a href="news.html">News</a></li>
            <li><a href="rl_training.html">Train</a></li>
            <li><a href="settings.html">Settings</a></li>
        </ul>
        <div class="user-info">
            <span class="market-status market-closed" id="marketStatus">Market CLOSED</span>
            <span>Welcome, Demo User</span>
            <!-- NOTE: Using console.log instead of alert/confirm for canvas compatibility -->
            <button class="btn btn-primary" onclick="logout()">LOGOUT</button>
        </div>
    </nav>
    <!-- END NEW NAVIGATION BAR -->

    <main class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
        <h2 class="text-3xl font-extrabold text-white mb-8">Live Market Data</h2>
        
        <div class="card p-6 w-full">
            <h3 class="text-2xl font-semibold mb-4 text-white border-b border-slate-600 pb-2">Global Watchlist (15+ Tickers)</h3>
            
            <!-- Loading Indicator -->
            <div id="loading" class="flex justify-center items-center py-10">
                <div class="loader"></div>
                <p class="ml-4 text-slate-400">Loading live data...</p>
            </div>
            
            <!-- Stock Table Container -->
            <div id="stockTableContainer" class="overflow-x-auto hidden">
                <table class="stock-table min-w-full divide-y divide-slate-700">
                    <thead>
                        <tr>
                            <th>Symbol</th>
                            <th>Company Name</th>
                            <th>Last Price</th>
                            <th>Change</th>
                            <th>% Change</th>
                            <th>Volume</th>
                        </tr>
                    </thead>
                    <tbody id="stockTableBody" class="divide-y divide-slate-800">
                        <!-- Stock rows will be inserted here by JavaScript -->
                    </tbody>
                </table>
            </div>
            
            <p id="lastUpdate" class="text-right text-sm mt-4 text-slate-500">Last updated: --</p>
        </div>
    </main>

    <script>
        // Finnhub API Configuration
        const FINNHUB_API_KEY = 'd3f9q79r01qolknc9vhgd3f9q79r01qolknc9vi0';
        const FINNHUB_BASE_URL = 'https://finnhub.io/api/v1';

        // Tickers for the live watchlist (more than 10)
        const LIVE_TICKERS = [
            { symbol: 'AAPL', name: 'Apple Inc.' },
            { symbol: 'MSFT', name: 'Microsoft Corp.' },
            { symbol: 'GOOGL', name: 'Alphabet Inc.' },
            { symbol: 'AMZN', name: 'Amazon.com Inc.' },
            { symbol: 'TSLA', name: 'Tesla, Inc.' },
            { symbol: 'NVDA', name: 'NVIDIA Corp.' },
            { symbol: 'JPM', name: 'JPMorgan Chase & Co.' },
            { symbol: 'V', name: 'Visa Inc.' },
            { symbol: 'JNJ', name: 'Johnson & Johnson' },
            { symbol: 'WMT', name: 'Walmart Inc.' },
            { symbol: 'BABA', name: 'Alibaba Group Holding' },
            { symbol: 'COST', name: 'Costco Wholesale Corp.' },
            { symbol: 'DIS', name: 'The Walt Disney Company' },
            { symbol: 'NFLX', name: 'Netflix, Inc.' },
            { symbol: 'PG', name: 'Procter & Gamble Co.' },
            { symbol: 'HD', name: 'Home Depot Inc.' },
        ];

        // --- Utility Functions for Navbar ---

        function updateMarketStatus() {
            const statusElement = document.getElementById('marketStatus');
            const now = new Date();
            const day = now.getDay(); // 0 = Sunday, 6 = Saturday
            const hour = now.getHours();
            
            // Simplified simulation: Market open Mon-Fri, 9 AM to 4 PM (hours 9, 10, 11, 12, 13, 14, 15)
            const isOpenDay = day >= 1 && day <= 5;
            const isOpenHour = hour >= 9 && hour < 16; 

            if (isOpenDay && isOpenHour) {
                statusElement.textContent = 'Market OPEN';
                statusElement.classList.remove('market-closed');
                statusElement.classList.add('market-open');
            } else {
                statusElement.textContent = 'Market CLOSED';
                statusElement.classList.remove('market-open');
                statusElement.classList.add('market-closed');
            }
        }
        
        function logout() {
            // Using console.log instead of alert/confirm for canvas environment compatibility
            console.log('User logged out. (Placeholder for real logout functionality)');
            // In a real application, you would handle session clearing and redirection here.
        }

        // --- Real API Call to Finnhub ---
        async function fetchLiveStockData() {
            const promises = LIVE_TICKERS.map(async ticker => {
                try {
                    const response = await fetch(
                        `${FINNHUB_BASE_URL}/quote?symbol=${ticker.symbol}&token=${FINNHUB_API_KEY}`
                    );
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    // Finnhub returns: c (current), d (change), dp (percent change), h (high), l (low), o (open), pc (previous close)
                    return {
                        symbol: ticker.symbol,
                        name: ticker.name,
                        price: data.c || 0,
                        change: data.d || 0,
                        change_percent: data.dp || 0,
                        volume: Math.floor(Math.random() * 5000000) + 1000000 // Finnhub doesn't provide volume in quote endpoint
                    };
                } catch (error) {
                    console.error(`Error fetching ${ticker.symbol}:`, error);
                    // Return placeholder data if API call fails
                    return {
                        symbol: ticker.symbol,
                        name: ticker.name,
                        price: 0,
                        change: 0,
                        change_percent: 0,
                        volume: 0
                    };
                }
            });
            
            const results = await Promise.all(promises);
            return results;
        }

        function renderStockTable(data) {
            const tableBody = document.getElementById('stockTableBody');
            const loadingIndicator = document.getElementById('loading');
            const tableContainer = document.getElementById('stockTableContainer');
            
            if (loadingIndicator) loadingIndicator.classList.add('hidden');
            if (tableContainer) tableContainer.classList.remove('hidden');

            const rows = data.map(stock => {
                const priceChangeClass = stock.change >= 0 ? 'positive' : 'negative';
                const sign = stock.change >= 0 ? '+' : '';

                return `
                    <tr class="hover:bg-slate-800 transition duration-150 ease-in-out">
                        <td class="font-bold text-white">${stock.symbol}</td>
                        <td class="text-slate-300">${stock.name}</td>
                        <td>$${stock.price.toFixed(2)}</td>
                        <td class="${priceChangeClass} font-semibold">${sign}${stock.change.toFixed(2)}</td>
                        <td class="${priceChangeClass} font-semibold">${sign}${stock.change_percent.toFixed(2)}%</td>
                        <td>${stock.volume.toLocaleString()}</td>
                    </tr>
                `;
            }).join('');

            tableBody.innerHTML = rows;

            // Update timestamp
            document.getElementById('lastUpdate').textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
        }

        async function updateDashboard() {
            try {
                const liveData = await fetchLiveStockData();
                renderStockTable(liveData);
            } catch (error) {
                console.error('Failed to update dashboard:', error);
                document.getElementById('stockTableBody').innerHTML = `
                    <tr><td colspan="6" class="text-center text-red-400 py-4">
                        Failed to load live data. Please check the API connection.
                    </td></tr>
                `;
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Initial load
            updateMarketStatus();
            updateDashboard();
            
            // Refresh every 60 seconds (Finnhub free tier has rate limits)
            setInterval(() => {
                updateMarketStatus();
                updateDashboard();
            }, 60000); 
        });

    </script>
</body>
</html>